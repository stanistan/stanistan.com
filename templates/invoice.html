{% extends "base.html" %}

{% block title %}Invoice{{ page.slug }}{% endblock title %}

{% block content %}

{% if config.extra.invoice.enabled %}

{% set invoice_url = config.extra.invoice.host ~ "/invoice-by-id/" ~ page.slug %}
{% set invoice = load_data(url=invoice_url, format="json") %}

<div class="invoice-heading">
    <h1>Invoice</h1>
    <div class="invoice-heading-code"><code>#INV{{ invoice.ID }}</code></div>
</div>

<div class="clear">
    <dl class="smaller">
        <dt>From</dt>
        <dd>
        {{ invoice.From.Name }} &lt;{{ invoice.From.Email }}&gt; <br />
        {{ invoice.From.Address | join(sep="<br />") | safe }}
        </dd>
        <dt>For</dt>
        <dd>
        {{ invoice.Client.ContactName }} &lt;{{ invoice.Client.ContactEmail }}&gt;<br />
        {{ invoice.Client.Company }} &lt;{{ invoice.Client.Website }}&gt; <br />
        </dd>
        <hr class="clear">
        <dt>Date</dt>
        <dd>{{ invoice.Date }}</dd>
        <dt>Due Date</dt>
        <dd>{{ invoice["Due Date"] }}</dd>
    </dl>
</div>

<div class="clear">
    <table>
        <thead>
            <tr>
                <th>Description</th>
                <th class="right">Qty x Rate</th>
                <th class="right">Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice["Invoice Item"] %}
            <tr>
                <td class="smaller">
                    <span>{{ item.Description }}</span>
                </td>
                <td class="smaller right">
                    <em>{{ item.Quantity }}</em> <span class="small">x</span> <em>{{ item["Invoice Rate"].Name }}</em>
                </td>
                <td class="right">{{ item.Amount }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td>Balance Due</td>
                <td colspan="2" class="right">{{ invoice["Total Amount"] }}</td>
            </tr>
        </tfoot>
    </table>
</div>
{% endif %}
{% endblock content %}
